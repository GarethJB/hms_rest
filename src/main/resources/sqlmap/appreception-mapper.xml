<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="re">

<!--예약리스트 조회 -->
<select id='appointment' resultType="app.reception.vo.MedicalReceiptVO" >
select to_char(m.time, 'day')today,to_char(m.time,'mm/dd')reserve_date_short, 
to_char(m.time,'hh24:mm')reserve_time, to_char(m.time,'yyyy-mm-dd')time, to_char(m.time, 'yymmddhh24mm') reserve_time_count,
to_char(current_date, 'yymmddhh24mm') current_time,
m.memo, p.name patient_name, s.name doctor_name,
d.department_name department_name, d.location location
from medical_receipt m inner join patient p
on m.patient_id= p.patient_id
inner join staff s
on m.staff_id = s.staff_id
inner join department d
on s.department_id =d.department_id
where to_char(m.time, 'yyyy-mm-dd') = #{time} 
<if test="id != 0">and s.department_id= #{id}</if>
order by reserve_time
</select>


<!--입원기록 조회  -->
<select id='ward' resultType="app.reception.vo.WardVO" >
select a.admission_date, a.discharge_date, s.name doctor_name, d.department_name, m.patient_id, p.name patient_name
from admission_record a inner join medical_record m
on a.medical_record_id = m.medical_record_id
inner join staff s
on s.staff_id = m.staff_id
inner join department d
on d.department_id = s. department_id
inner join ward w 
on w.ward_id= a.ward_id
inner join patient p
on m.patient_id = p.patient_id 
where m.patient_id =#{id}
</select>

 <!--처방기록 조회 -->
 <select id='prescription' resultType="app.reception.vo.PrescriptionVO">
 select p.*, to_char(treatment_date, 'yyyy-mm-dd') pres_date, to_char(treatment_date, 'yy-mm-dd') pres_date_short
,to_char(treatment_date, 'day') treatment_day,to_char(treatment_date, 'dy')treatment_day_short ,
treatment_name, pt.name patient_name, s.name doctor_name,  d.department_name department_name
from prescription_record p inner join medical_record m
on p.medical_record_id = m.medical_record_id
inner join patient pt
on m.patient_id = pt.patient_id 
inner join staff s
on m.staff_id =s.staff_id
inner join department d
on d.department_id= s.department_id
where pt.patient_id=#{id} 
 
 </select>
 
 <!-- 환자진료기록 조회 -->
<select id='medical_record' resultType="app.reception.vo.MedicalRecordVO" > 
 select p.patient_id, p.social_id, p.name patient, p.gender, p.phone_number, m.treatment_date,
to_char(m.treatment_date, 'yyyy-mm-dd')record_date,to_char(m.treatment_date, 'hh24:mi')record_time ,
to_char(m.treatment_date, 'dy')record_day, m.treatment_name, m.admission,
pr.prescription_name, s.name doctor, d.department_name
from patient p left outer join medical_record m
on p.patient_id = m.patient_id
left outer join prescription_record pr
on m.medical_record_id = pr.medical_record_id
left outer join staff s
on s.staff_id = m.staff_id
left outer join department d
on s.department_id =d.department_id
where p.patient_id =#{id}
order by m.treatment_date desc
</select> 

<!--환자진료기록 조회 by id-->
<select id='meidcal_record_id' resultType="app.reception.vo.MedicalRecordVO" >
select p.patient_id, p.social_id, p.name patient, p.gender, p.phone_number, m.treatment_date,
to_char(m.treatment_date, 'yyyy-mm-dd')record_date,to_char(m.treatment_date, 'hh24:mi')record_time ,
to_char(m.treatment_date, 'dy')record_day, m.treatment_name, m.admission,
pr.prescription_name, s.name doctor, d.department_name
from patient p left outer join medical_record m
on p.patient_id = m.patient_id
left outer join prescription_record pr
on m.medical_record_id = pr.medical_record_id
left outer join staff s
on s.staff_id = m.staff_id
left outer join department d
on s.department_id =d.department_id
where p.patient_id =#{id}
order by m.treatment_date desc
</select>

<!-- 환자진료기록 조회 by map-->
<select id='medical_record' resultType="app.reception.vo.MedicalRecordVO" >
select p.patient_id, p.social_id, p.name patient, p.gender, p.phone_number, m.treatment_date,
to_char(m.treatment_date, 'yyyy-mm-dd')record_date,
to_char(m.treatment_date, 'hh24:mi')record_time ,
to_char(m.treatment_date, 'dy')record_day, m.treatment_name, m.admission,
pr.prescription_name, s.name doctor, d.department_name
from patient p left outer join medical_record m
on p.patient_id = m.patient_id
left outer join prescription_record pr
on m.medical_record_id = pr.medical_record_id
left outer join staff s
on s.staff_id = m.staff_id
left outer join department d
on s.department_id =d.department_id
where p.patient_id =#{id}
and to_char(m.treatment_date, 'yyyy-mm-dd') between #{from} and #{to}
order by m.treatment_date desc
</select>


<!-- 환자예약정보 조회 -->
<select id ='patient_appointment'  resultType="app.reception.vo.MedicalReceiptVO" >
select to_char(m.time, 'yyyy-mm-dd') reserve_date, to_char(m.time, 'hh24:ss') reserve_time,
m.memo, p.name patient_name , s.name doctor_name, d.department_name department_name, to_char(m.time,'dy') reserve_day
from medical_receipt m inner join patient p
on m.patient_id = p.patient_id
inner join staff s
on m.staff_id= s.staff_id
inner join department d
on s.department_id = d.department_id
where p.patient_id = #{id}
order by m.time desc
</select>

<!-- 환자인적사항 조회 by id-->
<select id ='id' resultType="app.reception.vo.PatientVO">
select p.*, r.admission admission
from patient p inner join medical_record r 
on p.patient_id = r.patient_id
where r.patient_id =#{id}
</select>

<!-- 환자인적사항 조회 by name-->
<select id='patient' resultType="app.reception.vo.PatientVO">
select * from patient 
where name =#{name}
</select>

<!-- 로그인하기 -->
<select id='login' resultType="app.staff.vo.StaffVO">
select * from staff
where staff_id=#{id} and pw = #{pw} 
</select>


	
</mapper>